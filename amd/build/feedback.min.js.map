{"version":3,"file":"feedback.min.js","sources":["../src/feedback.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nrequire.config({\n    paths: {\n        'datatables.net': M.cfg.wwwroot + '/report/myfeedback/vendor/js/jquery.dataTables.min',\n        'datatables.net-buttons': M.cfg.wwwroot + '/report/myfeedback/vendor/js/dataTables.buttons.min',\n        'datatables.net-colreorder': M.cfg.wwwroot + '/report/myfeedback/vendor/js/dataTables.colReorder.min',\n        'datatables.net-fixedheader': M.cfg.wwwroot + '/report/myfeedback/vendor/js/dataTables.fixedHeader.min',\n        'datatables.net-responsive': M.cfg.wwwroot + '/report/myfeedback/vendor/js/dataTables.responsive.min',\n    },\n});\n\ndefine([\n    'jquery',\n    'datatables.net',\n    'datatables.net-buttons',\n    'datatables.net-colreorder',\n    'datatables.net-fixedheader',\n    'datatables.net-responsive',\n], function($) {\n\n    return {\n        init: function() {\n            /* Plugin API method to determine is a column is sortable */\n            $.fn.dataTable.Api.register('column().searchable()', function() {\n                var ctx = this.context[0];\n                return ctx.aoColumns[this[0]].bSearchable;\n            });\n\n            $(document).ready(function() {\n                const $feedbackcomments = $('#feedbackcomments');\n\n                var filterCells = $('thead tr:eq(1) td');\n\n                // Create the DataTable.\n                var feedbacktable = $feedbackcomments.DataTable({\n                    dom: 'RlfBrtip',\n                    fixedHeader: true,\n                    pageLength: 25,\n                    orderCellsTop: true,\n                    columnDefs: [\n                        {\n                            targets: [5, 6, 7],\n                            searchable: false,\n                            orderable:  false\n                        }\n                    ],\n                    order: [[3, 'desc']],\n                    buttons: ['colvis'],\n                    stateSave: true,\n                    stateSaveCallback: function(settings, data) {\n                        localStorage.setItem('Feedback', JSON.stringify(data));\n                    },\n                    stateLoadCallback: function() {\n                        return JSON.parse(localStorage.getItem('Feedback'));\n                    },\n                    responsive: true,\n                    colReorder: true,\n                });\n\n                // Add filtering.\n                feedbacktable.columns().every(async function() {\n                    if (this.searchable()) {\n                        var that = this;\n\n                        // Create the `select` element.\n                        var select = $('<select><option value=\"\"></option></select>')\n                            .appendTo(\n                                filterCells.eq(feedbacktable.colReorder.transpose(this.index(), 'toOriginal'))\n                            )\n                            .on('change', function() {\n                                that\n                                    .search($(this).val())\n                                    .draw();\n                            });\n\n                        // Add data.\n                        this\n                            .data()\n                            .sort()\n                            .unique()\n                            .each(function(d) {\n                                select.append($('<option>' + d + '</option>'));\n                            });\n\n                        // Restore state saved values\n                        var state = this.state.loaded();\n                        if (state) {\n                            var val = state.columns[this.index()];\n                            select.val(val.search.search);\n                        }\n                    }\n                });\n\n                // When button is clicked to reset table.\n                $('#ftableDestroy').on('click', function() {\n                    feedbacktable.colReorder.reset();\n                    feedbacktable.destroy(false);\n                    $('thead select').val('').change();\n                    feedbacktable.state.clear();\n                    location.reload();\n                });\n\n                $('#exportexcel').on('click', function() {\n                    window.location.href = 'export.php';\n                });\n\n                $('#reportPrint').on('click', function() {\n                    print();\n                });\n\n                $feedbackcomments.on('click', '.addnote', function() {\n                    var gradeid = $(this).data('gid');\n                    var instn = $(this).data('inst');\n                    $('#gradeid').val(gradeid);\n                    $('#instance1').val(instn);\n                    $('#user_id').val($(this).data('uid'));\n                    $('#notename').val($('#note-val' + gradeid + instn).text());\n                });\n\n                $feedbackcomments.on('click', '.addfeedback', function() {\n                    var gradeid2 = $(this).data('gid');\n                    var instn = $(this).data('inst');\n                    $('#gradeid2').val(gradeid2);\n                    $('#instance').val(instn);\n                    $('#user_id2').val($(this).data('uid'));\n                    $('#feedname').val($('#feed-val' + gradeid2 + instn).text());\n                    $('#Abs1').modal('show');\n                });\n            });\n        }\n    };\n});\n"],"names":["require","config","paths","M","cfg","wwwroot","define","$","init","fn","dataTable","Api","register","this","context","aoColumns","bSearchable","document","ready","$feedbackcomments","filterCells","feedbacktable","DataTable","dom","fixedHeader","pageLength","orderCellsTop","columnDefs","targets","searchable","orderable","order","buttons","stateSave","stateSaveCallback","settings","data","localStorage","setItem","JSON","stringify","stateLoadCallback","parse","getItem","responsive","colReorder","columns","every","async","that","select","appendTo","eq","transpose","index","on","search","val","draw","sort","unique","each","d","append","state","loaded","reset","destroy","change","clear","location","reload","window","href","print","gradeid","instn","text","gradeid2","modal"],"mappings":"AAeAA,QAAQC,OAAO,CACXC,MAAO,kBACeC,EAAEC,IAAIC,QAAU,8EACRF,EAAEC,IAAIC,QAAU,kFACbF,EAAEC,IAAIC,QAAU,sFACfF,EAAEC,IAAIC,QAAU,sFACjBF,EAAEC,IAAIC,QAAU,4DAIrDC,oCAAO,CACH,SACA,iBACA,yBACA,4BACA,6BACA,8BACD,SAASC,SAED,CACHC,KAAM,WAEFD,EAAEE,GAAGC,UAAUC,IAAIC,SAAS,yBAAyB,kBACvCC,KAAKC,QAAQ,GACZC,UAAUF,KAAK,IAAIG,eAGlCT,EAAEU,UAAUC,OAAM,iBACRC,kBAAoBZ,EAAE,yBAExBa,YAAcb,EAAE,qBAGhBc,cAAgBF,kBAAkBG,UAAU,CAC5CC,IAAK,WACLC,aAAa,EACbC,WAAY,GACZC,eAAe,EACfC,WAAY,CACR,CACIC,QAAS,CAAC,EAAG,EAAG,GAChBC,YAAY,EACZC,WAAY,IAGpBC,MAAO,CAAC,CAAC,EAAG,SACZC,QAAS,CAAC,UACVC,WAAW,EACXC,kBAAmB,SAASC,SAAUC,MAClCC,aAAaC,QAAQ,WAAYC,KAAKC,UAAUJ,QAEpDK,kBAAmB,kBACRF,KAAKG,MAAML,aAAaM,QAAQ,cAE3CC,YAAY,EACZC,YAAY,IAIhBxB,cAAcyB,UAAUC,OAAMC,oBACtBnC,KAAKgB,aAAc,KACfoB,KAAOpC,KAGPqC,OAAS3C,EAAE,+CACV4C,SACG/B,YAAYgC,GAAG/B,cAAcwB,WAAWQ,UAAUxC,KAAKyC,QAAS,gBAEnEC,GAAG,UAAU,WACVN,KACKO,OAAOjD,EAAEM,MAAM4C,OACfC,eAKRtB,OACAuB,OACAC,SACAC,MAAK,SAASC,GACXZ,OAAOa,OAAOxD,EAAE,WAAauD,EAAI,qBAIrCE,MAAQnD,KAAKmD,MAAMC,YACnBD,MAAO,KACHP,IAAMO,MAAMlB,QAAQjC,KAAKyC,SAC7BJ,OAAOO,IAAIA,IAAID,OAAOA,aAMlCjD,EAAE,kBAAkBgD,GAAG,SAAS,WAC5BlC,cAAcwB,WAAWqB,QACzB7C,cAAc8C,SAAQ,GACtB5D,EAAE,gBAAgBkD,IAAI,IAAIW,SAC1B/C,cAAc2C,MAAMK,QACpBC,SAASC,YAGbhE,EAAE,gBAAgBgD,GAAG,SAAS,WAC1BiB,OAAOF,SAASG,KAAO,gBAG3BlE,EAAE,gBAAgBgD,GAAG,SAAS,WAC1BmB,WAGJvD,kBAAkBoC,GAAG,QAAS,YAAY,eAClCoB,QAAUpE,EAAEM,MAAMuB,KAAK,OACvBwC,MAAQrE,EAAEM,MAAMuB,KAAK,QACzB7B,EAAE,YAAYkD,IAAIkB,SAClBpE,EAAE,cAAckD,IAAImB,OACpBrE,EAAE,YAAYkD,IAAIlD,EAAEM,MAAMuB,KAAK,QAC/B7B,EAAE,aAAakD,IAAIlD,EAAE,YAAcoE,QAAUC,OAAOC,WAGxD1D,kBAAkBoC,GAAG,QAAS,gBAAgB,eACtCuB,SAAWvE,EAAEM,MAAMuB,KAAK,OACxBwC,MAAQrE,EAAEM,MAAMuB,KAAK,QACzB7B,EAAE,aAAakD,IAAIqB,UACnBvE,EAAE,aAAakD,IAAImB,OACnBrE,EAAE,aAAakD,IAAIlD,EAAEM,MAAMuB,KAAK,QAChC7B,EAAE,aAAakD,IAAIlD,EAAE,YAAcuE,SAAWF,OAAOC,QACrDtE,EAAE,SAASwE,MAAM"}